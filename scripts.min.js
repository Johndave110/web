(function () {
  function applyTheme(t) {
    document.documentElement.setAttribute("data-theme", t);
  }
  const saved = localStorage.getItem("theme") || "light";
  if (saved === "dark") applyTheme("dark");
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("themeToggle");
    if (!btn) return;
    const updateLabel = () => {
      btn.textContent =
        document.documentElement.getAttribute("data-theme") === "dark"
          ? "â˜€ï¸ Light"
          : "ðŸŒ— Dark";
    };
    updateLabel();
    btn.addEventListener("click", () => {
      const current =
        document.documentElement.getAttribute("data-theme") === "dark"
          ? "dark"
          : "light";
      const next = current === "dark" ? "light" : "dark";
      applyTheme(next);
      localStorage.setItem("theme", next);
      updateLabel();
    });
  });
})();

document.addEventListener("DOMContentLoaded", () => {
  const logoutLinks = Array.from(
    document.querySelectorAll('a.logout[href*="logout.php"]')
  );
  if (!logoutLinks.length) return;
  logoutLinks.forEach((l) => {
    l.removeAttribute("onclick");
  });
  const backdrop = document.createElement("div");
  backdrop.className = "modal-backdrop";
  backdrop.innerHTML = `
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="logout-modal-title">
      <span class="close-btn" data-close>&times;</span>
      <div class="modal-header" id="logout-modal-title">Confirm Logout</div>
      <div class="modal-body">Are you sure you want to log out?</div>
      <div class="modal-buttons">
        <button type="button" class="btn btn-danger" id="confirm-yes">Logout</button>
        <button type="button" class="btn btn-secondary" id="confirm-no">Cancel</button>
      </div>
    </div>`;
  document.body.appendChild(backdrop);
  let targetHref = null;
  const openModal = (e) => {
    targetHref = e;
    backdrop.style.display = "flex";
    document.getElementById("confirm-no").focus();
  };
  const closeModal = () => {
    backdrop.style.display = "none";
    targetHref = null;
  };
  logoutLinks.forEach((link) => {
    link.addEventListener("click", (e) => {
      e.preventDefault();
      openModal(link.getAttribute("href"));
    });
  });
  backdrop.addEventListener("click", (e) => {
    if (e.target === backdrop) closeModal();
  });
  backdrop.querySelector("[data-close]").addEventListener("click", closeModal);
  document.getElementById("confirm-no").addEventListener("click", closeModal);
  document.getElementById("confirm-yes").addEventListener("click", () => {
    if (targetHref) window.location.href = targetHref;
  });
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && backdrop.style.display === "flex") closeModal();
  });
});
